<body style="background-color: rgb(232, 248, 250)">
    <div class="row mt-4">
      <div class="col-3 border navDiv">
          <%- include('./partials/navbar.ejs') %>
      </div>
      <div class="col">
        <div class="container">
          <h4>Supplier Cash Payments</h4>
          <hr />
        </div>
        <div class="container result mt-2">
          <%- include('./partials/successMsg.ejs') %>
          <%- include('./partials/error.ejs') %>
        </div>
        <div class="container">
          <div class="row">
            <div class="col">
              <button class="btn btn-outline-info" data-toggle="collapse" data-target="#createNew">
                Create New
              </button>
              
            </div>
            <div class="col d-flex justify-content-end searchDiv_1">
              <!-- <form action="/search" method="post"> -->
              <!-- <div class="container sticky" id="searchDiv_1">
                <div class="input-group">
                  <input id="search_input" name="search_input" type="text" class="form-control"
                    placeholder="Search Products" />
                  <div class="input-group-append">
                    <button name="search_submit_button" class="btn btn-info" type="submit">
                      Search
                    </button>
                  </div>
                </div>
              </div> -->
              <!-- </form> -->
            </div>
          </div>
          <div id="createNew" class="collapse">
            <form action="/accounts/payToSupplier" method="post">
              <div class="row p-3">
                <div class="col-sm">
                  <div class="row mt-3">
                    <div class="col-lg-4">
                      <h6><label for="date">Date</label></h6>
                    </div>
                    <div class="col-lg-8">
                      <input type="date" class="form-control" name="date"/>
                    </div>
                  </div>
                  <div class="row mt-3">
                    <div class="col-lg-4">
                      <h6><label for="amount">Amount Tk.</label></h6>
                    </div>
                    <div class="col-lg-8">
                      <input type="text" class="form-control" name="amount" placeholder="Amount
                      " />
                    </div>
                  </div>
                  <div class="row mt-3">
                    <div class="col-lg-4">
                      <h6><label for="comment">Comment</label></h6>
                    </div>
                    <div class="col-lg-8">
                      <input type="text" class="form-control" name="comment" placeholder="Comment" />
                    </div>
                  </div>
                </div>
                <div class="col-sm">
                  <div class="row">
                    <div class="col">
                      <% if (locals.supplier) {%>
                        <div class="row mt-3">
                                  <div class="col-lg-4 mt-2 text-right">
                                      <h6><label for="supplier"><span style="color: red;">* </span>Supplier</label></h6>
                                  </div>
                                  <div class="col-lg-8">
                                       <div class="form-group">
                                    <select class="form-control" id="supplier" name="supplier">
                                      <option value="Select Supplier" selected>Select Supplier</option>
                                      <% if (locals.supplier) { locals.supplier.forEach(function(s) {%>
                                        <option><%= s.name %></option>
                                    <% } )}%>
                                    </select>
                                  </div>
                                  </div>
                              </div>
                     <% } else {%>
                      <div class="row mt-3">
                                  <div class="col-lg-4 mt-2 text-right">
                                      <h6><label for="supplier"><span style="color: red;">* </span>Supplier</label></h6>
                                  </div>
                                  <div class="col-lg-8">
                                    <button class="btn btn-outline-info" type="button"><a href="/supplier" class="text-dark" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">Add Supplier</a></button>
                                  </div>
                              </div>
                    <% }%>
                     
                    </div>
                  </div>
                  <div class="row mt-3">
                    <div class="col-lg-4">
                      <h6><label for="balance">Opening Balance</label></h6>
                    </div>
                    <div class="col-lg-8">
                      <input type="hidden" class="form-control" name="prvBalance" readonly/>
                      <input type="text" class="form-control" name="balance" readonly/>
                    </div>
                  </div>
                  <div class="row mt-3">
                    <div class="col-lg-4">
                      <h6><label for="Cbalance">Closing Balance</label></h6>
                    </div>
                    <div class="col-lg-8">
                      <input type="text" class="form-control" name="Cbalance" readonly/>
                    </div>
                  </div>
                </div>
              </div>
              <div class="container d-flex justify-content-end mt-4 mr-3">
                <input class="btn btn-outline-success mr-2" name="submit" type="submit" value="Pay" />
              </div>
            </form>
          </div>
        </div>
        <div class="container mt-2">
          <table class="table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Supplier Name</th>
                <th>Balance</th>
              </tr>
            </thead>
            <tbody>
              <% if (locals.payments) { locals.payments.forEach(function(s) {
                let date = s.peyment_date.toLocaleDateString("en-US")
                 %>
                <tr>
                  <td><%= date %></td>
                  <td><%= s.receiver %></td>
                  <td><%= s.amount %></td>
                </tr>
            <% })} %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <script>
      function logout() {
        document.cookie = "pcs=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        location.href = "/";
      }
      $(document).ready(() => {
        $(`button[name="search_submit_button"]`).click(() => {
          let SI = $(`input[name="search_input"]`).val()
          $.ajax({
            url: "/bank/bank_search",
            method: 'POST',
            data: {
              SI: SI
            },
            success: (data) => {
              if (data == "No Bank found!") {
                alert("No Bank found!")
              } else {
                $('tbody').empty()
                for (let i = 0; i < data.length; i++) {
                  const elem = data[i];
                  $('tbody').prepend(
                    `<tr>
                    <td>${elem.name}</td>
                    <td>${elem.branch}</td>
                    <td>${elem.ac_nr}</td>
                    <td>${elem.balance}</td>
                  </tr>`
                  )
                }
              
              }
            }
          })
        });  
        $("#supplier").change(() => {
          let supplier = $("#supplier").val()
          $.ajax({
            url: "/supplier/supplier_search",
            type: "post",
            data: {
              SI : supplier
            },
            success: (data) => {
              $(`input[name="balance"]`).val(data[0].balance)
              $(`input[name="prvBalance"]`).val(data[0].balance)
            }
          })
        })
      
        $(`input[name="amount"]`).keyup(() => {
          let amount = $(`input[name="amount"]`).val()
          let balance = $(`input[name="prvBalance"]`).val()
          let totalBalance = Number(amount) + Number(balance)
          $(`input[name="Cbalance"]`).val(totalBalance)
        })
      
      
      
      })
    </script>
  </body>